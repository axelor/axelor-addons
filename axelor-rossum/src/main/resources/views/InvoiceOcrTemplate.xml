<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.2.xsd">

	<grid model="com.axelor.apps.rossum.db.InvoiceOcrTemplate" title="Invoice Ocr Template" name="invoice-ocr-template-grid">
      <field name="name"/>
	</grid>
  
	<form model="com.axelor.apps.rossum.db.InvoiceOcrTemplate" title="Invoice Ocr Template" name="invoice-ocr-template-form" width="large">
		<panel name="generalPanel">
			<field name="name"/>
			<field name="templateFile" widget="binary-link" onChange="action-invoice-ocr-template-group-onchange-template-file"/>
			<field name="timeout" min="0"/>
			<field name="queue" readonlyIf="exportedFile != null"/>
			<field name="exportTypeSelect" required="true" readonlyIf="exportedFile != null" selection-in="['csv']"/>
			<button name="generateTemplateBtn" title="Generate Template" showIf="exportedFile == null &amp;&amp; !queue.useConfirmedState"
			   onClick="save,action-invoice-ocr-template-method-onclick-create-template" readonlyIf="!templateFile"/>
         <button name="uploadFileBtn" title="Upload file to Rossum" showIf="exportedFile == null &amp;&amp; queue.useConfirmedState"
            onClick="save,action-invoice-ocr-template-method-onclick-upload-file" readonlyIf="!templateFile"/>
		</panel>
		<panel name="ecportedDataPanel" title="Exported Data From Ocr" showIf="exportedFile != null">
         <field name="exportedFile" readonly="true"/>
		</panel>
		<panel name="generateInvoicePanel" title="Invoice details" showIf="exportTypeSelect == 'csv' &amp;&amp; exportedFile != null">
         <field name="invoiceOperationTypeSelect" requiredIf="exportTypeSelect == 'csv' &amp;&amp; exportedFile != null"/>
         <field name="invoiceOperationSubTypeSelect" requiredIf="exportTypeSelect == 'csv' &amp;&amp; exportedFile != null"/>
         <button name="generateInvoice" title="Generate Invoice" showIf="exportTypeSelect == 'csv' &amp;&amp; exportedFile != null"
            onClick="save,action-invoice-ocr-template-method-onclick-generate-invoice"/>
		</panel>
		<panel name="hiddenPanel" hidden="true" colSpan="12">
         <field name="queue.useConfirmedState"/>
		</panel>
   </form>

   <form model="com.axelor.apps.rossum.db.InvoiceOcrTemplate" title="Invoice Ocr Template" name="invoice-ocr-template-popup-form"
      width="large">
      <panel name="generalPanel">
         <field name="name" required="true"/>
      </panel>
   </form>

   <form model="com.axelor.apps.base.db.Wizard" title="Fill template details" name="invoice-ocr-template-wizard-form"
      onNew="action-invoice-ocr-template-wizard-record-onnew">
      <panel name="mainPanel">
         <field name="annotation" type="many-to-one" target="com.axelor.apps.rossum.db.Annotation" readonly="true"/>
         <field name="invoiceOcrTemplate" type="many-to-one" target="com.axelor.apps.rossum.db.InvoiceOcrTemplate" required="true"
            form-view="invoice-ocr-template-popup-form" grid-view="invoice-ocr-template-grid" canNew="true" canEdit="false"/>
         <button name="exportAnnotationBtn" onClick="save,action-invoice-ocr-template-wizard-method-export-annotation"
            title="Export"/>
      </panel>
   </form>

   <action-record name="action-invoice-ocr-template-wizard-record-onnew" model="com.axelor.apps.base.db.Wizard">
      <field name="annotation" expr="eval: __repo__(Annotation).find(_annotationId)"/>
   </action-record>

   <action-group name="action-invoice-ocr-template-group-onchange-template-file">
      <action name="action-invoice-ocr-template-validate-template-file" if="templateFile == null"/>
      <action name="action-invoice-ocr-template-record-reset-exported-data"/>
   </action-group>

   <action-validate name="action-invoice-ocr-template-validate-template-file">
      <alert message="Warning, existing exported data will be deleted, do you wish to continue?"/>
   </action-validate>

   <action-record name="action-invoice-ocr-template-record-reset-exported-data" model="com.axelor.apps.rossum.db.InvoiceOcrTemplate">
      <field name="exportedFile" expr="eval: null"/>
   </action-record>

   <action-method name="action-invoice-ocr-template-method-onclick-create-template">
      <call class="com.axelor.apps.rossum.web.InvoiceOcrTemplateController" method="createTemplate"/>
   </action-method>

   <action-method name="action-invoice-ocr-template-method-onclick-upload-file">
      <call class="com.axelor.apps.rossum.web.InvoiceOcrTemplateController" method="uploadFile"/>
   </action-method>

   <action-method name="action-invoice-ocr-template-method-onclick-generate-invoice">
      <call class="com.axelor.apps.rossum.web.InvoiceOcrTemplateController" method="generateInvoice"/>
   </action-method>

</object-views>
